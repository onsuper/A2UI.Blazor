@inherits A2UIComponentBase
@using A2UI.Core.Processing
@inject DataBindingResolver BindingResolver

@if (!string.IsNullOrEmpty(ResolvedUrl))
{
    <div class="@GetCssClass()" style="@GetInlineStyle()">
        <audio controls style="width: 100%;">
            <source src="@ResolvedUrl" />
            您的浏览器不支持音频播放。
        </audio>
        @if (!string.IsNullOrEmpty(ResolvedDescription))
        {
            <div class="audio-description" style="margin-top: 8px; font-size: 0.9em; color: #666;">
                @ResolvedDescription
            </div>
        }
    </div>
}

@code {
    private string? ResolvedUrl;
    private string? ResolvedDescription;

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        // Get the url bound value
        var urlValue = GetDictionaryProperty("url");
        if (urlValue != null)
        {
            ResolvedUrl = BindingResolver.ResolveString(urlValue, SurfaceId, Component.DataContextPath);
        }

        // Get the description bound value
        var descriptionValue = GetDictionaryProperty("description");
        if (descriptionValue != null)
        {
            ResolvedDescription = BindingResolver.ResolveString(descriptionValue, SurfaceId, Component.DataContextPath);
        }
    }

    protected override string GetCssClass()
    {
        return Theme.Components.AudioPlayer;
    }
}

